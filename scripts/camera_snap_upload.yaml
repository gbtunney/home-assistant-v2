#####
# SCRIPTS: Camera Snapshot and Upload
# https://www.home-assistant.io/integrations/script/
# https://www.home-assistant.io/docs/configuration/splitting_configuration/
#####
camera_snap_and_upload:
  alias: Camera Snapshot and Upload
  description: >
    "- Takes camera snapshot and saves
    - Uploads to google photos 
    - Sends notification when completed "
  icon: mdi:camera-retake-outline
  sequence:
    - variables:
        response: not set
        upload_google: true
        filename:
          "{% from 'camera.jinja' import snapshot_path %}{{ snapshot_path(
          entity | default('camera.camera_1_q5_profile1')  ) }}"
    - action: camera.snapshot
      metadata: {}
      data:
        filename: /media/{{ filename }}
      target:
        entity_id: "{{entity | default('camera.camera_1_q5_profile1') }}"
    - if:
        - condition: template
          value_template: "{{ upload_google }}"
      then:
        - action: google_photos.upload
          metadata: {}
          data:
            config_entry_id: 01JDXZWF95N644N5ACX8K3Q189
            filename: /media/{{ filename }}
            album: Home Assistant Camera
          response_variable: response
      alias: Upload to Google photos
    - action: persistent_notification.create
      metadata: {}
      data:
        title: Snapshot Success!
        message:
          "File was created at: /media/{{ filename }}  Google Upload status:
          {{ response }}"
    - action: input_text.set_value
      metadata: {}
      data:
        value: media-source://media_source/local/{{filename}}
      target:
        entity_id: input_text.url_llv
