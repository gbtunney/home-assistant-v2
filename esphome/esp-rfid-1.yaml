# ============================================================
# DEVICE â€” NFC/RFID Reader (PN532, I2C)
# ============================================================
#
# Role:
# - NFC/RFID tag UID reading (PN532 via I2C)
# - Standard diagnostics
#
# ============================================================

substitutions:
  # Identity
  device_id: rfid_reader_1
  device_hostname: "rfid-reader-1"
  device_friendly_name: "Cat Fountain NFC"
  device_description: "PN532 NFC/RFID reader for cat fountain tags."
  # Logging
  log_level: DEBUG

packages:
  # Base + platform + fleet
  base: !include common/universal_base.yaml
  board: !include common/platforms/esp32.yaml
  fleet: !include fleets/nfc_reader.yaml
  # Network performance tweaks
  #net_perf: !include common/overrides/wifi_performance.yaml

  # Capabilities
  diagnostics: !include common/capabilities/diagnostics.yaml

# I2C bus (ESP32 default pins)
#i2c:
# sda: 21
#scl: 22
#scan: true

i2c:
  sda: GPIO21
  scl: GPIO22
  scan: true
  frequency: 100kHz

pn532_i2c:
  id: pn532_board
  address: 0x24
  update_interval: 1s
  on_tag:
    then:
      - logger.log:
          level: INFO
          format: "NFC TAG DETECTED: %s"
          args: ["x.c_str()"]
      - text_sensor.template.publish:
          id: last_tag_uid
          state: !lambda "return x;"

text_sensor:
  - platform: template
    name: "Last NFC Tag UID"
    id: last_tag_uid
    update_interval: never
