# ============================================================
# DEVICE — CYD 3-BUTTON PANEL (Network-only bring-up)
# ============================================================

substitutions:
  # Logging inherits default INFO from the universal base.
  # For troubleshooting, temporarily set per-device to DEBUG, then revert.
  #log_level: INFO

  # ----------------------------------------------------------
  # DEVICE IDENTITY
  # ----------------------------------------------------------
  device_id: cyd_display_1
  device_hostname: "cyd-display-1"
  device_friendly_name: "CYD Display 1"
  device_description: "Network-only bring-up (no display/touch)"

  # OTA/uploader target address (used by override include)
  wifi_use_address: "192.168.1.129"

packages:
  # ----------------------------------------------------------
  # BASE + PLATFORM
  # (assumes these define esphome/wifi/api/ota/logger basics)
  # ----------------------------------------------------------
  base: !include common/universal_base.yaml
  board: !include common/platforms/esp32.yaml
  fleet: !include fleets/cyd_panel.yaml

  # ----------------------------------------------------------
  # NETWORK OVERRIDES (optional, per-device)
  # ----------------------------------------------------------
  net_perf: !include common/overrides/wifi_performance.yaml
  net_use_address: !include common/overrides/wifi_use_address.yaml

  # ----------------------------------------------------------
  # CAPABILITIES
  # ----------------------------------------------------------
  diagnostics: !include common/capabilities/diagnostics.yaml


# ============================================================ 
# ESPHome Display related setup
#
# Create a font to use, add and remove glyphs as needed. 
font:
  - file: 'fonts/Arimo-Regular.ttf'
    id: arimo20
    size: 20
    glyphs: "!\"%()+=,-_.:°0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZÅÄÖ abcdefghijklmnopqrstuvwxyzåäö"

# Create a Home Assistant blue color
color:
  - id: ha_blue
    hex: 51c0f2

# ============================================================ 
# Home Assistant related setup
#
light:
  - platform: monochromatic
    output: backlight_pwm
    name: Display Backlight
    id: backlight
    restore_mode: ALWAYS_ON

# ============================================================ 
# Hardware related setup
#
# Setup SPI for the display. The ESP32-2432S028R uses separate SPI buses for display and touch
spi:
  - id: tft
    clk_pin: GPIO14
    mosi_pin: GPIO13
    miso_pin: GPIO12
  - id: touch
    clk_pin: GPIO25
    mosi_pin: GPIO32
    miso_pin: GPIO39

# Setup a pin to control the backlight
output:
  - platform: ledc
    pin: GPIO21
    id: backlight_pwm

# Setup the ili9xxx platform
#
# Display is used as 240x320 by default so we rotate it to 90°
display:
  - platform: ili9xxx
    model: ili9341
    spi_id: tft
    cs_pin: GPIO15
    dc_pin: GPIO2
    rotation: 90
    invert_colors: false
    lambda: |-
      it.print(160, 140, id(arimo20), id(ha_blue), TextAlign::BOTTOM_CENTER, "Hello World!");
      it.rectangle(0, 0, 320, 240, id(ha_blue));