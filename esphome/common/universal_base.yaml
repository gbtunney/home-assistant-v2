# ============================================================
# UNIVERSAL BASE â€” ALL DEVICES
# ============================================================
#
# Provides:
# - Core ESPHome identity
# - Logger defaults
# - API + OTA
# - WiFi + fallback AP
#
# This file MUST NOT contain hardware-specific logic.
# ============================================================

substitutions:
  # -------------------------
  # DEVICE IDENTITY
  # -------------------------
  # device_hostname defaults to device_id unless overridden per device
  device_hostname: ${device_id}

  # -------------------------
  # OPTIONAL OTA TARGET
  # -------------------------
  # Set this per-device ONLY if mDNS is unreliable.
  # Leave empty ("") to disable.
  device_use_address: ""

  # -------------------------
  # GLOBAL DEFAULTS
  # -------------------------
  log_level: "INFO"

  # -------------------------
  # NETWORK DEFAULTS
  # -------------------------
  wifi_ssid: "!secret wifi_ssid"
  wifi_password: "!secret wifi_password"
  fallback_ap_password: "!secret fallback_ap_password"

  # -------------------------
  # OTA / API DEFAULTS
  # -------------------------
  api_encryption_key: "!secret api_encryption_key"
  ota_password: "!secret ota_password"

esphome:
  # Hostname rule:
  # - device_hostname may be overridden per device
  # - defaults to device_id if not explicitly set
  name: ${device_hostname}
  friendly_name: ${device_friendly_name}
  comment: ${device_description}
  project:
    name: ${fleet_project}
    version: ${fleet_firmware_version}

logger:
  level: ${log_level}

api:
  encryption:
    key: ${api_encryption_key}

ota:
  - platform: esphome
    password: ${ota_password}

wifi:
  # Optional direct IP / hostname for OTA uploads.
  # Rule:
  # - Leave empty to use mDNS (.local)
  # - Set to an IP (e.g. 192.168.1.14) to bypass mDNS
  # - Do NOT put this in secrets
  use_address: ${device_use_address}

  ssid: ${wifi_ssid}
  password: ${wifi_password}

  ap:
    ssid: "${device_friendly_name} Fallback"
    password: ${fallback_ap_password}

captive_portal:
