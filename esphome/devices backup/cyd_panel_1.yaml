# ============================================================
# DEVICE — CYD 3-BUTTON PANEL (Network-only bring-up)
# ============================================================

substitutions:
  # Logging inherits default INFO from the universal base.
  # For troubleshooting, temporarily set per-device to DEBUG, then revert.
  #log_level: INFO

  # ----------------------------------------------------------
  # DEVICE IDENTITY
  # ----------------------------------------------------------
  device_id: cyd_display_1
  device_hostname: "cyd-display-1"
  device_friendly_name: "CYD Display 1"
  device_description: "Network-only bring-up (no display/touch)"

  # OTA/uploader target address (used by override include)
  wifi_use_address: "192.168.1.129"

packages:
  # ----------------------------------------------------------
  # BASE + PLATFORM
  # (assumes these define esphome/wifi/api/ota/logger basics)
  # ----------------------------------------------------------
  base: !include common/universal_base.yaml
  board: !include common/platforms/esp32.yaml
  fleet: !include fleets/cyd_panel.yaml

  # ----------------------------------------------------------
  # NETWORK OVERRIDES (optional, per-device)
  # ----------------------------------------------------------
  net_perf: !include common/overrides/wifi_performance.yaml
  net_use_address: !include common/overrides/wifi_use_address.yaml

  # ----------------------------------------------------------
  # CAPABILITIES
  # ----------------------------------------------------------
  diagnostics: !include common/capabilities/diagnostics.yaml

# No SPI/display/touch here — we’re just proving network stability.

output:
  - platform: ledc
    pin: GPIO21
    id: lcd_backlight
    frequency: 5000 Hz

light:
  - platform: monochromatic
    id: cyd_backlight
    output: lcd_backlight
    name: "CYD Backlight"
    default_transition_length: 0s
    restore_mode: ALWAYS_ON

button:
  - platform: restart
    name: "Restart CYD Panel"
  - platform: safe_mode
    name: "Restart in Safe Mode"
    disabled_by_default: true

  # Simple test buttons
  - platform: template
    name: "Backlight On"
    icon: mdi:brightness-7
    on_press:
      - output.set_level:
          id: lcd_backlight
          level: 1.0

  - platform: template
    name: "Backlight Off"
    icon: mdi:brightness-2
    on_press:
      - output.turn_off: lcd_backlight

  - platform: template
    name: "Test Notification"
    icon: mdi:bell
    on_press:
      - homeassistant.service:
          service: persistent_notification.create
          data:
            title: "ESPHome Test"
            message: "Button pressed from CYD Display 1"

esphome:
  on_boot:
    priority: 800
    then:
      - output.set_level:
          id: lcd_backlight
          level: 1.0
